extends account

block content
  .user
    include navigation
    .user-content.flex-fix
      .user-content-reviews
        h2.form-heading Billing & Payments
        .billing-total
          h3 Total Spent: ₹#{totalSpent}
        .review-list
          if orders && orders.length > 0
            each order in orders
              .order-group
                .review-header
                  .order-id #ORD-#{order._id.toString().slice(-6).toUpperCase()}
                  .order-date= order.paidAt ? order.paidAt.toLocaleDateString() : 'N/A'
                  .order-status(class=`status-${order.status}`)= order.status
                each item in order.items
                  if item.product && item.product._id && item.product.slug && item.product.slug !== ''
                    .review-card(data-order-id=order.razorpayOrderId, data-product-id=item.product._id)
                      .review-header
                        img.review-product-img(src=`/img/${item.product.category}/${item.product.imageCover || 'placeholder.jpg'}`, alt=item.product.name)
                        .review-product-info
                          .review-product-name= item.product.name
                          .review-product-price ₹#{item.price}
                          .review-product-quantity Quantity: #{item.quantity}
                        .review-date= order.paidAt ? order.paidAt.toLocaleDateString() : 'N/A'
                      .order-payment
                        .payment-info
                          .payment-label Payment Method:
                          .payment-value Razorpay (ID: #{order.razorpayPaymentId || 'N/A'})
                        .payment-info
                          .payment-label Total Amount:
                          .payment-value ₹#{order.totalAmount}
                        .payment-info
                          .payment-label Paid On:
                          .payment-value= order.paidAt ? order.paidAt.toLocaleDateString() : 'N/A'
                      .review-actions
                        a.review-action-btn(href=`/product/${item.product.slug}` data-slug=item.product.slug) View Details
                        button.review-action-btn.order-action-delete(data-order-id=order.razorpayOrderId, data-product-id=item.product._id) Delete
                  else
                    script.
                      console.log('Invalid product in order: ' + "#{order._id}", {
                        productId: "#{item.product && item.product._id ? item.product._id : 'missing'}",
                        slug: "#{item.product && item.product.slug ? item.product.slug : 'missing'}"
                      });
          else
            .no-reviews
              i.fas.fa-box-open
              | No payment history found